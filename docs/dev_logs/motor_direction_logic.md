# 底盘电机转向配置与控制逻辑分析

## 问题描述
在调试底盘自转 (`rotate`) 功能时，观察到以下现象：
1. 修改 `config/chasis_params.yaml` 中的 `left_dir` / `right_dir` 配置，会直接影响两个电机最终转向是“同向”还是“反向”。
2. 修改控制指令中角速度 `angular_z` 的正负（即左转或右转），只会让两个电机同时反向，但不会改变它们之间的“同向/反向”关系。

## 核心原理分析

底盘运动控制的最终输出是由**转速大小**、**配置修正系数**和**逻辑方向**三个因子共同决定的。

公式如下：

$$
\text{最终输出} = \underbrace{\text{RPM}}_{\text{转速大小}} \times \underbrace{\text{Config\_Dir}}_{\text{配置修正}} \times \underbrace{\text{Logic\_Dir}}_{\text{逻辑方向}}
$$

### 1. 因子定义
*   **RPM**: 电机转速的绝对值，永远为正。
*   **Config_Dir**: 来自配置文件 `chasis_params.yaml` 的物理极性修正（`left_dir`, `right_dir`），通常为 `1` 或 `-1`。用于适配电机安装方向。
*   **Logic_Dir**: 代码逻辑中定义的运动模式方向。
    *   **直线运动**: 左右轮逻辑均为 `+1`。
    *   **自转运动**: 左轮 `-1`，右轮 `+1`（或相反），逻辑上必须**相反**。

### 2. 现象解释

#### 为什么改配置 (`Config_Dir`) 会影响“同向/异向”关系？
在自转逻辑中，代码强制要求 `Logic_Dir` 是一正一负（例如左 `-1`，右 `+1`）。
此时最终输出符号的关系完全取决于 `Config_Dir`：

*   **如果配置为同号 (例如均为 1)**：
    *   左轮输出 $\propto 1 \times (-1) = -1$
    *   右轮输出 $\propto 1 \times (+1) = +1$
    *   **结果**：最终输出**异号**（一正一负）。

*   **如果配置为异号 (例如左 -1, 右 1)**：
    *   左轮输出 $\propto (-1) \times (-1) = +1$
    *   右轮输出 $\propto 1 \times (+1) = +1$
    *   **结果**：最终输出**同号**（均为正）。

因此，配置文件的符号一致性直接锁定了两轮最终输出的相对关系。

#### 为什么改转速方向 (`angular_z` 正负) 不影响关系？
改变 `angular_z` 的正负（如从左转变为右转），相当于把 `Logic_Dir` 整体取反：
*   **左转**: 左 `-1`，右 `+1` —— 逻辑相反。
*   **右转**: 左 `+1`，右 `-1` —— 逻辑依然相反。

无论怎么转，代码逻辑层面的“对立关系”没有变。因此，如果配置导致它们是“同号”的，那么左转时它们同正，右转时它们同负，始终保持“同号”。

## 结论
*   **配置文件 (`chasis_params.yaml`)**：决定了**“物理层”**如何解释信号。如果电机安装是对称镜像的，通常需要配置为一正一负，才能让两个轮子在收到“正”信号时都让车头朝前。
*   **控制函数 (`rotate`)**：决定了**“意图”**。自转的意图就是“左右互搏”。

在调试时，应优先通过**直线运动测试**确定 `Config_Dir` 的正确性（确保给正指令时车头向前），确认无误后，自转逻辑自然会符合预期。
