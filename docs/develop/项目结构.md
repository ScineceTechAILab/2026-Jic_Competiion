项目目录说明与建议布局

概览

此文档说明仓库内主要目录的职责、推荐的 Python 包/测试布局，以及如何为 CI/自动化测试准备项目。

当前主要目录（摘录）

- `launch/`
  - ROS2 启动文件，负责把相关节点/参数一起启动。保持为启动编排用，不放业务逻辑。

- `src/` （源码）
  - `*/include/*`：放可复用的模块/库代码（Python 模块），例如 `include/chassis_control/i2c_driver.py`。
  - `*/scripts/*`：可执行入口脚本或 ROS 节点脚本（CLI、交互、测试脚本），应尽量只做参数解析/初始化，业务逻辑由 `include` 中模块实现。
  - `*/launch/*`：与该子系统相关的 ROS2 launch 文件。

- `doc/`：项目文档（开发手册、设计说明、目录规范等）。

改进建议（最小可行改动）

1) 标准化 Python 包布局
   - 在每个 `include/<pkg>/` 中添加 `__init__.py`，并确保模块以包的形式被导入（例如 `from chassis_control.i2c_driver import I2CDriver`）。

2) scripts 仅作为入口
   - 把硬件交互/业务逻辑放入 `include`，`scripts` 只负责用户交互或作为 ROS 节点入口，这样更容易做单元测试与 CI 模拟。

3) 测试与 CI
   - 新增 `tests/` 目录放单元测试，使用 `pytest` + `pytest-mock`，对硬件（例如 `smbus2`）进行 monkeypatch 模拟。
   - 提供 `requirements-dev.txt` 包含 `pytest`、`pytest-mock`、`flake8`、`mypy` 等开发依赖。
   - 在 CI 中（例如 GitHub Actions）使用虚拟环境安装 `requirements-dev.txt` 并运行 linter 与 tests。

4) 文档与贡献指南
   - 在根目录添加 `CONTRIBUTING.md`，包含本地开发、创建虚拟环境、运行测试、提交 PR 的规范。

示例：如何把 `test_i2c.py` 改造为可测试结构

1) 新建驱动模块：
   `src/execution/chassis_control/include/chassis_control/i2c_driver.py`
   - 提供 `I2CDriver`，包含 `scan()`, `read(addr,len)`, `write(addr,data)`, `close()`。

2) 修改脚本：
   `src/execution/chassis_control/scripts/test_i2c.py` 只 import `I2CDriver` 并调用。

单元测试策略

- 对外部硬件依赖（smbus2 / i2cdev）使用 monkeypatch 或依赖注入进行替换。
- 保持测试不依赖真实硬件，CI 中直接运行。

示例 CI（高层）

- Install Python
- pip install -r requirements.txt
- pip install -r requirements-dev.txt
- flake8 && mypy
- pytest --cov

常见问题

- 如果仓库同时作为 ROS2 包发布，请确保 `package.xml` 与 `setup.cfg`/`pyproject.toml` 保持一致，测试文件应放在仓库根的 `tests/`，不放入 ROS 包安装路径中。

附录

- 推荐阅读：`doc/devolop/开发手册.md`、`doc/standard/文件树规范.md`（已有）
